<meta charset="utf-8" emacsmode="-*- markdown -*-"><link rel="stylesheet" href="https://casual-effects.com/markdeep/latest/slate.css?">
[首页][blog_link]

# 关于friendlycore: 
- https://wiki.friendlyarm.com/wiki/index.php/FriendlyCore_(based_on_ubuntu-core_with_Qt)/zh#.E8.BF.9E.E6.8E.A5.E4.BB.A5.E5.A4.AA.E7.BD.91)
        
        
- https://wiki.friendlyarm.com/wiki/index.php/NanoPi_R2S/zh

# 安装
## 安装记得先把zip解压为img再刷入SD卡
## mount SD卡到对应的分区扩容分区， 我用的是cfdisk，省事

# 配置连接R2S

## 默认开机只有wan口的dhcpcd，需要你用另一个路由器给R2S做dhcp server
## 不过应该也可以mount对应的分区进入SD卡修改dhcp为静态ip然后网线直连ssh过去
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~shell
apt-get install emacs-nox
emacs /etc/netplan/50-cloud-init.yaml:
#我的eth0是wan eth1是LAN，即eth0 dhcp-client ， eth1 dhcp-server
INTERFACESv4="eth1"
INTERFACESv6=""
root@FriendlyELEC:~# cat /etc/netplan/50-cloud-init.yaml
network:
    ethernets:
        eth0:
            dhcp4: true
        eth1:
            dhcp4: false
            addresses: [10.10.0.1/24]
    version: 2

netplan apply
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# 配置dhcp server

~~~~~~~~~~~~~~~~~~~~~~~shell
#注意联网
apt-get install isc-dhcp-server #安装dhcp server


emacs /etc/default/isc-dhcp-server:
INTERFACESv4="eth1"
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~shell
emacs /etc/dhcp/dhcpd.conf:
option domain-name "friendly";
option domain-name-servers  114.114.114.114,8.8.8.8;

default-lease-time 86400;
max-lease-time 86400;
ddns-update-style none;
subnet 10.10.0.0 netmask 255.255.255.0
{
  # Specify the default gateway address                                                                         
  option routers 10.10.0.1;
  # Specify the subnet-mask                                                                                     
  option subnet-mask 255.255.255.0;
  option broadcast-address 10.10.0.255;
  option domain-name-servers 114.114.114.114;
  # Specify the range of leased IP addresses                                                                    
  range 10.10.0.50 10.10.0.200;
}
systemctl start  isc-dhcp-server
systemctl status  isc-dhcp-server
#这个配置有问题看/var/log/syslog 排除问题
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~shell
#配置ipv4包转发
sysctl -n  net.ipv4.ip_forward #查看是否为1

emacs /etc/sysctl.conf:
net.ipv4.ip_forward=1 # 不是1，修改配置文件
sysctl -p #生效配置
sysctl -n  net.ipv4.ip_forward #查看是否为1

#配置iptables 转发
apt-get install iptables
iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -o eth0 -j MASQUERADE
#此时应该可以通过LAN口访问到公网了
#即ping www.bing.com可以通了
# 由于iptables重启失效，因此使用iptables-save保存配置
iptables-save -c &>> iptables_rules

cat iptables_rules：
# Generated by iptables-save v1.8.4 on Fri Apr  2 19:56:37 2021
*nat
:PREROUTING ACCEPT [24:1577]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
[23:1516] -A POSTROUTING -s 10.10.0.0/24 -o eth0 -j MASQUERADE
COMMIT
# Completed on Fri Apr  2 19:56:37 2021

mv iptables_rules /etc
emacs /etc/rc.local:#设置开机自启动iptables的规则
cd /etc/ && ./start_iptables.sh
exit 0

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# 配置完成 推荐购买个ap（Access Point）




[blog_link]:https://xtccc.github.io/small_parking.github.io/

<style class="fallback">body{visibility:hidden}</style><script>markdeepOptions={tocStyle:'long'};</script>

<!-- Markdeep: --><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js?" charset="utf-8"></script>
